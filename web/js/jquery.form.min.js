(function(c){"function"===typeof define&&define.amd?define(["jquery"],c):c("undefined"!=typeof jQuery?jQuery:window.Zepto)})(function(c){function t(a){var h=a.data;a.isDefaultPrevented()||(a.preventDefault(),c(a.target).ajaxSubmit(h))}function y(a){var h=a.target,d=c(h);if(!d.is("[type=submit],[type=image]")){h=d.closest("[type=submit]");if(0===h.length)return;h=h[0]}var b=this;b.clk=h;"image"==h.type&&(void 0!==a.offsetX?(b.clk_x=a.offsetX,b.clk_y=a.offsetY):"function"==typeof c.fn.offset?(d=d.offset(),
b.clk_x=a.pageX-d.left,b.clk_y=a.pageY-d.top):(b.clk_x=a.pageX-h.offsetLeft,b.clk_y=a.pageY-h.offsetTop));setTimeout(function(){b.clk=b.clk_x=b.clk_y=null},100)}function r(){if(c.fn.ajaxSubmit.debug){var a="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(a):window.opera&&window.opera.postError&&window.opera.postError(a)}}var B,D;B=void 0!==c("<input type='file'/>").get(0).files;D=void 0!==window.FormData;var H=!!c.fn.prop;c.fn.attr2=function(){if(!H)return this.attr.apply(this,
arguments);var a=this.prop.apply(this,arguments);return a&&a.jquery||"string"===typeof a?a:this.attr.apply(this,arguments)};c.fn.ajaxSubmit=function(a){function h(b){b=c.param(b,a.traditional).split("&");var h=b.length,f=[],g,d;for(g=0;g<h;g++)b[g]=b[g].replace(/\+/g," "),d=b[g].split("="),f.push([decodeURIComponent(d[0]),decodeURIComponent(d[1])]);return f}function d(b){for(var f=new FormData,d=0;d<b.length;d++)f.append(b[d].name,b[d].value);if(a.extraData)for(b=h(a.extraData),d=0;d<b.length;d++)b[d]&&
f.append(b[d][0],b[d][1]);a.data=null;d=c.extend(!0,{},c.ajaxSettings,a,{contentType:!1,processData:!1,cache:!1,type:g||"POST"});a.uploadProgress&&(d.xhr=function(){var b=c.ajaxSettings.xhr();b.upload&&b.upload.addEventListener("progress",function(c){var b=0,d=c.loaded||c.position,f=c.total;c.lengthComputable&&(b=Math.ceil(d/f*100));a.uploadProgress(c,d,f,b)},!1);return b});d.data=null;var m=d.beforeSend;d.beforeSend=function(c,b){b.data=a.formData?a.formData:f;m&&m.call(this,c,b)};return c.ajax(d)}
function b(b){function d(a){var c=null;try{a.contentWindow&&(c=a.contentWindow.document)}catch(b){r("cannot get iframe.contentWindow document: "+b)}if(c)return c;try{c=a.contentDocument?a.contentDocument:a.document}catch(b){r("cannot get iframe.contentDocument: "+b),c=a.document}return c}function f(){function a(){try{var c=d(v).readyState;r("state = "+c);c&&"uninitialized"==c.toLowerCase()&&setTimeout(a,50)}catch(b){r("Server abort: ",b," (",b.name,")"),h(2),C&&clearTimeout(C),C=void 0}}var b=n.attr2("target"),
k=n.attr2("action"),l=n.attr("enctype")||n.attr("encoding")||"multipart/form-data";m.setAttribute("target",t);g&&!/post/i.test(g)||m.setAttribute("method","POST");k!=e.url&&m.setAttribute("action",e.url);e.skipEncodingOverride||g&&!/post/i.test(g)||n.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"});e.timeout&&(C=setTimeout(function(){y=!0;h(1)},e.timeout));var p=[];try{if(e.extraData)for(var q in e.extraData)e.extraData.hasOwnProperty(q)&&(c.isPlainObject(e.extraData[q])&&e.extraData[q].hasOwnProperty("name")&&
e.extraData[q].hasOwnProperty("value")?p.push(c('<input type="hidden" name="'+e.extraData[q].name+'">').val(e.extraData[q].value).appendTo(m)[0]):p.push(c('<input type="hidden" name="'+q+'">').val(e.extraData[q]).appendTo(m)[0]));e.iframeTarget||w.appendTo("body");v.attachEvent?v.attachEvent("onload",h):v.addEventListener("load",h,!1);setTimeout(a,15);try{m.submit()}catch(u){document.createElement("form").submit.apply(m)}}finally{m.setAttribute("action",k),m.setAttribute("enctype",l),b?m.setAttribute("target",
b):n.removeAttr("target"),c(p).remove()}}function h(a){if(!k.aborted&&!A)if(q=d(v),q||(r("cannot access response document"),a=2),1===a&&k)k.abort("timeout"),x.reject(k,"timeout");else if(2==a&&k)k.abort("server abort"),x.reject(k,"error","server abort");else if(q&&q.location.href!=e.iframeSrc||y){v.detachEvent?v.detachEvent("onload",h):v.removeEventListener("load",h,!1);a="success";var b;try{if(y)throw"timeout";var f="xml"==e.dataType||q.XMLDocument||c.isXMLDoc(q);r("isXml="+f);if(!f&&window.opera&&
(null===q.body||!q.body.innerHTML)&&--B){r("requeing onLoad callback, DOM not available");setTimeout(h,250);return}var g=q.body?q.body:q.documentElement;k.responseText=g?g.innerHTML:null;k.responseXML=q.XMLDocument?q.XMLDocument:q;f&&(e.dataType="xml");k.getResponseHeader=function(a){return{"content-type":e.dataType}[a.toLowerCase()]};g&&(k.status=Number(g.getAttribute("status"))||k.status,k.statusText=g.getAttribute("statusText")||k.statusText);var m=(e.dataType||"").toLowerCase(),l=/(json|script|text)/.test(m);
if(l||e.textarea){var n=q.getElementsByTagName("textarea")[0];if(n)k.responseText=n.value,k.status=Number(n.getAttribute("status"))||k.status,k.statusText=n.getAttribute("statusText")||k.statusText;else if(l){var p=q.getElementsByTagName("pre")[0],t=q.getElementsByTagName("body")[0];p?k.responseText=p.textContent?p.textContent:p.innerText:t&&(k.responseText=t.textContent?t.textContent:t.innerText)}}else"xml"==m&&!k.responseXML&&k.responseText&&(k.responseXML=D(k.responseText));try{z=G(k,m,e)}catch(E){a=
"parsererror",k.error=b=E||a}}catch(E){r("error caught: ",E),a="error",k.error=b=E||a}k.aborted&&(r("upload aborted"),a=null);k.status&&(a=200<=k.status&&300>k.status||304===k.status?"success":"error");"success"===a?(e.success&&e.success.call(e.context,z,"success",k),x.resolve(k.responseText,"success",k),u&&c.event.trigger("ajaxSuccess",[k,e])):a&&(void 0===b&&(b=k.statusText),e.error&&e.error.call(e.context,k,a,b),x.reject(k,"error",b),u&&c.event.trigger("ajaxError",[k,e,b]));u&&c.event.trigger("ajaxComplete",
[k,e]);u&&!--c.active&&c.event.trigger("ajaxStop");e.complete&&e.complete.call(e.context,k,a);A=!0;e.timeout&&clearTimeout(C);setTimeout(function(){e.iframeTarget?w.attr("src",e.iframeSrc):w.remove();k.responseXML=null},100)}}var m=n[0],l,e,u,t,w,v,k,y,C,x=c.Deferred();x.abort=function(a){k.abort(a)};if(b)for(l=0;l<p.length;l++)b=c(p[l]),H?b.prop("disabled",!1):b.removeAttr("disabled");e=c.extend(!0,{},c.ajaxSettings,a);e.context=e.context||e;t="jqFormIO"+(new Date).getTime();e.iframeTarget?(w=c(e.iframeTarget),
(l=w.attr2("name"))?t=l:w.attr2("name",t)):(w=c('<iframe name="'+t+'" src="'+e.iframeSrc+'" />'),w.css({position:"absolute",top:"-1000px",left:"-1000px"}));v=w[0];k={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(a){var b="timeout"===a?"timeout":"aborted";r("aborting upload... "+b);this.aborted=1;try{v.contentWindow.document.execCommand&&v.contentWindow.document.execCommand("Stop")}catch(d){}w.attr("src",
e.iframeSrc);k.error=b;e.error&&e.error.call(e.context,k,b,a);u&&c.event.trigger("ajaxError",[k,e,b]);e.complete&&e.complete.call(e.context,k,b)}};(u=e.global)&&0===c.active++&&c.event.trigger("ajaxStart");u&&c.event.trigger("ajaxSend",[k,e]);if(e.beforeSend&&!1===e.beforeSend.call(e.context,k,e))return e.global&&c.active--,x.reject(),x;if(k.aborted)return x.reject(),x;(b=m.clk)&&(l=b.name)&&!b.disabled&&(e.extraData=e.extraData||{},e.extraData[l]=b.value,"image"==b.type&&(e.extraData[l+".x"]=m.clk_x,
e.extraData[l+".y"]=m.clk_y));b=c("meta[name=csrf-token]").attr("content");(l=c("meta[name=csrf-param]").attr("content"))&&b&&(e.extraData=e.extraData||{},e.extraData[l]=b);e.forceSync?f():setTimeout(f,10);var z,q,B=50,A,D=c.parseXML||function(a,b){window.ActiveXObject?(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a)):b=(new DOMParser).parseFromString(a,"text/xml");return b&&b.documentElement&&"parsererror"!=b.documentElement.nodeName?b:null},F=c.parseJSON||function(a){return window.eval("("+
a+")")},G=function(a,b,d){var e=a.getResponseHeader("content-type")||"",f="xml"===b||!b&&0<=e.indexOf("xml");a=f?a.responseXML:a.responseText;f&&"parsererror"===a.documentElement.nodeName&&c.error&&c.error("parsererror");d&&d.dataFilter&&(a=d.dataFilter(a,b));"string"===typeof a&&("json"===b||!b&&0<=e.indexOf("json")?a=F(a):("script"===b||!b&&0<=e.indexOf("javascript"))&&c.globalEval(a));return a};return x}if(!this.length)return r("ajaxSubmit: skipping submit process - no element selected"),this;
var g,f,n=this;"function"==typeof a?a={success:a}:void 0===a&&(a={});g=a.type||this.attr2("method");f=a.url||this.attr2("action");(f=(f="string"===typeof f?c.trim(f):"")||window.location.href||"")&&(f=(f.match(/^([^#]+)/)||[])[1]);a=c.extend(!0,{url:f,success:c.ajaxSettings.success,type:g||c.ajaxSettings.type,iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},a);f={};this.trigger("form-pre-serialize",[this,a,f]);if(f.veto)return r("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),
this;if(a.beforeSerialize&&!1===a.beforeSerialize(this,a))return r("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var m=a.traditional;void 0===m&&(m=c.ajaxSettings.traditional);var p=[],l=this.formToArray(a.semantic,p);a.data&&(a.extraData=a.data);if(a.beforeSubmit&&!1===a.beforeSubmit(l,this,a))return r("ajaxSubmit: submit aborted via beforeSubmit callback"),this;this.trigger("form-submit-validate",[l,this,a,f]);if(f.veto)return r("ajaxSubmit: submit vetoed via form-submit-validate trigger"),
this;f=F(l,a.extraData);"GET"==a.type.toUpperCase()?(a.url+=(0<=a.url.indexOf("?")?"&":"?")+f,a.data=null):a.data=f;var u=[];a.resetForm&&u.push(function(){n.resetForm()});a.clearForm&&u.push(function(){n.clearForm(a.includeHidden)});if(!a.dataType&&a.target){var t=a.success||function(){};u.push(function(b){var d=a.replaceTarget?"replaceWith":"html";c(a.target)[d](b).each(t,arguments)})}else a.success&&u.push(a.success);a.success=function(b,c,d){for(var f=a.context||this,g=0,h=u.length;g<h;g++)u[g].apply(f,
[b,c,d||n,n])};if(a.error){var y=a.error;a.error=function(b,c,d){y.apply(a.context||this,[b,c,d,n])}}if(a.complete){var G=a.complete;a.complete=function(b,c){G.apply(a.context||this,[b,c,n])}}f=0<c("input[type=file]:enabled",this).filter(function(){return""!==c(this).val()}).length;var m="multipart/form-data"==n.attr("enctype")||"multipart/form-data"==n.attr("encoding"),A=B&&D;r("fileAPI :"+A);var z;!1!==a.iframe&&(a.iframe||(f||m)&&!A)?a.closeKeepAlive?c.get(a.closeKeepAlive,function(){z=b(l)}):
z=b(l):z=(f||m)&&A?d(l):c.ajax(a);n.removeData("jqxhr").data("jqxhr",z);for(f=0;f<p.length;f++)p[f]=null;this.trigger("form-submit-notify",[this,a]);return this};c.fn.ajaxForm=function(a){a=a||{};a.delegation=a.delegation&&c.isFunction(c.fn.on);if(!a.delegation&&0===this.length){var h=this.selector,d=this.context;if(!c.isReady&&h)return r("DOM not ready, queuing ajaxForm"),c(function(){c(h,d).ajaxForm(a)}),this;r("terminating; zero elements found by selector"+(c.isReady?"":" (DOM not ready)"));return this}return a.delegation?
(c(document).off("submit.form-plugin",this.selector,t).off("click.form-plugin",this.selector,y).on("submit.form-plugin",this.selector,a,t).on("click.form-plugin",this.selector,a,y),this):this.ajaxFormUnbind().bind("submit.form-plugin",a,t).bind("click.form-plugin",a,y)};var F=function(a,h){var d,b=[],g=[],f=function(a,c){g[g.length]=a;c=jQuery.isFunction(c)?c():""==c?null:c;null!=c&&""!=c&&(b[b.length]=encodeURIComponent(a)+"="+encodeURIComponent(c))};(jQuery.isArray(a)||a.jquery&&!jQuery.isPlainObject(a))&&
jQuery.each(a,function(){f(this.name,this.value)});if(null!=h&&"undefind"!=typeof h)for(d in h)-1==c.inArray(d,g)&&f(d,h[d]);return b.join("&").replace(/%20/g,"+")};c.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")};c.fn.formToArray=function(a,h){var d=[];if(0===this.length)return d;var b=this[0],g=this.attr("id"),f=a?b.getElementsByTagName("*"):b.elements;f&&!/MSIE [678]/.test(navigator.userAgent)&&(f=c(f).get());g&&(g=c(':input[form="'+g+'"]').get(),g.length&&
(f=(f||[]).concat(g)));if(!f||!f.length)return d;var n,m,p,l,r;n=0;for(r=f.length;n<r;n++)if(l=f[n],(g=l.name)&&!l.disabled)if(a&&b.clk&&"image"==l.type)b.clk==l&&(d.push({name:g,value:c(l).val(),type:l.type}),d.push({name:g+".x",value:b.clk_x},{name:g+".y",value:b.clk_y}));else if((p=c.fieldValue(l,!0))&&p.constructor==Array)for(h&&h.push(l),m=0,l=p.length;m<l;m++)d.push({name:g,value:p[m]});else if(B&&"file"==l.type)if(h&&h.push(l),p=l.files,p.length)for(m=0;m<p.length;m++)d.push({name:g,value:p[m],
type:l.type});else d.push({name:g,value:"",type:l.type});else null!==p&&"undefined"!=typeof p&&(h&&h.push(l),d.push({name:g,value:p,type:l.type,required:l.required}));!a&&b.clk&&(f=c(b.clk),n=f[0],(g=n.name)&&!n.disabled&&"image"==n.type&&(d.push({name:g,value:f.val()}),d.push({name:g+".x",value:b.clk_x},{name:g+".y",value:b.clk_y})));return d};c.fn.formSerialize=function(a){return c.param(this.formToArray(a))};c.fn.fieldSerialize=function(a){var h=[];this.each(function(){var d=this.name;if(d){var b=
c.fieldValue(this,a);if(b&&b.constructor==Array)for(var g=0,f=b.length;g<f;g++)h.push({name:d,value:b[g]});else null!==b&&"undefined"!=typeof b&&h.push({name:this.name,value:b})}});return c.param(h)};c.fn.fieldValue=function(a){for(var h=[],d=0,b=this.length;d<b;d++){var g=c.fieldValue(this[d],a);null===g||"undefined"==typeof g||g.constructor==Array&&!g.length||(g.constructor==Array?c.merge(h,g):h.push(g))}return h};c.fieldValue=function(a,h){var d=a.name,b=a.type,g=a.tagName.toLowerCase();void 0===
h&&(h=!0);if(h&&(!d||a.disabled||"reset"==b||"button"==b||("checkbox"==b||"radio"==b)&&!a.checked||("submit"==b||"image"==b)&&a.form&&a.form.clk!=a||"select"==g&&-1==a.selectedIndex))return null;if("select"==g){var f=a.selectedIndex;if(0>f)return null;for(var d=[],g=a.options,n=(b="select-one"==b)?f+1:g.length,f=b?f:0;f<n;f++){var m=g[f];if(m.selected){var p=m.value;p||(p=m.attributes&&m.attributes.value&&!m.attributes.value.specified?m.text:m.value);if(b)return p;d.push(p)}}return d}return c(a).val()};
c.fn.clearForm=function(a){return this.each(function(){c("input,select,textarea",this).clearFields(a)})};c.fn.clearFields=c.fn.clearInputs=function(a){var h=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var d=this.type,b=this.tagName.toLowerCase();h.test(d)||"textarea"==b?this.value="":"checkbox"==d||"radio"==d?this.checked=!1:"select"==b?this.selectedIndex=-1:"file"==d?/MSIE/.test(navigator.userAgent)?c(this).replaceWith(c(this).clone(!0)):
c(this).val(""):a&&(!0===a&&/hidden/.test(d)||"string"==typeof a&&c(this).is(a))&&(this.value="")})};c.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})};c.fn.enable=function(a){void 0===a&&(a=!0);return this.each(function(){this.disabled=!a})};c.fn.selected=function(a){void 0===a&&(a=!0);return this.each(function(){var h=this.type;"checkbox"==h||"radio"==h?this.checked=a:"option"==this.tagName.toLowerCase()&&
(h=c(this).parent("select"),a&&h[0]&&"select-one"==h[0].type&&h.find("option").selected(!1),this.selected=a)})};c.fn.ajaxSubmit.debug=!1});
